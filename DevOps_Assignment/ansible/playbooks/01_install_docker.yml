- name: Install Docker and prerequisites on all nodes
hosts: swarm
become: yes
tasks:
- name: Update apt cache
apt:
update_cache: yes


- name: Install packages
apt:
name:
- apt-transport-https
- ca-certificates
- curl
- gnupg-agent
- software-properties-common
state: present


- name: Add Docker GPG key
apt_key:
url: https://download.docker.com/linux/ubuntu/gpg
state: present


- name: Add Docker repo
apt_repository:
repo: deb [arch=amd64] https://download.docker.com/linux/ubuntu focal stable
state: present


- name: Install docker-ce
apt:
name:
- docker-ce
- docker-ce-cli
- containerd.io
state: present
update_cache: yes


- name: Ensure docker service running
service:
name: docker
state: started
enabled: yes


- name: Install python3-pip
apt:
name: python3-pip
state: present


- name: Install docker-compose (python version)
pip:
name: docker-compose
executable: pip3